function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        if (decodeURIComponent(pair[0]) == variable) {
            return decodeURIComponent(pair[1]); //.replace(/['"]+/g, '');
        }
    }
}

function getValidQuery(q) {
    var validQuery = "";
    if ((q.toUpperCase() === "AND") || (q.toUpperCase() === "OR") || q.startsWith("-"))
        return validQuery;
     
    validQuery = q;
    if (validQuery.startsWith("+") || validQuery.startsWith("*") || validQuery.startsWith("?")) 
        validQuery = validQuery.substring(1, validQuery.length);
        
    var n = validQuery.indexOf("*");
    if (n > -1) {
       validQuery = validQuery.substring(0, n);
    } else  {
       n = validQuery.indexOf("?");
       if (n > -1) {
          validQuery = validQuery.substring(0, n);
       }
    }
    return validQuery;
}

$(function () {
   $(".runnable")
       .attr({ title: "Click to run this script" })
       .css({ cursor: "pointer"})
       .click(function () 
       {  eval($(this).text()); });
   var q = getQueryVariable('search');
   if (q) {
      var queries = q.match(/\S+/g);
      if (queries.length > 0) {   
         var i=0;
         while ( queries.length > i) {
             if (queries[i].toUpperCase() === "NOT") {
                i+=2;
             } else {
                   var query = getValidQuery(queries[i]);
                   if (query)
                       $('body').highlight(query);
                   i++;   
             }
        }
        if ($('span.highlight').length > 0) {
           $('html, body').animate({
              scrollTop: $('span.highlight').offset().top - 50
           }, 1000);
        }   
     }
   }       
});
